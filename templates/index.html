{% extends "base.html" %}
{% block title %}Squid Blocked Domains{% endblock %}

{% block content %}
<div class="card">
    <h2>Squid Blocked Domains</h2>
    <div class="actions">
        <form id="restartForm" action="{{ url_for('restart_squid') }}" method="post" style="display:inline;">
            <button type="submit">Restart Squid</button>
        </form>
        <form action="{{ url_for('index') }}" method="get" style="display:inline;">
            <button type="submit">Refresh List</button>
        </form>
        <form action="{{ url_for('allowed') }}" method="get" style="display:inline;">
            <button type="submit">View Allowed Sites</button>
        </form>
    </div>
    <table>
        <tr>
            <th>Domain</th>
            <th>Action</th>
        </tr>
        {% for d in domains %}
        <tr>
            <td>{{ d.domain }}</td>
            <td>
                <form action="{{ url_for('add_allow') }}" method="post" style="display:inline;">
                    <input type="hidden" name="domain" value="{{ d.domain }}">
                    <button type="submit">Add to Allow List ({{ d.parent }})</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

<!-- Please Wait Modal -->
<div id="waitModal" class="modal">
  <div class="modal-content">
    <div class="spinner"></div>
    <p>Restarting Squid, please wait...</p>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
  var restartForm = document.getElementById('restartForm');
  if (restartForm) {
    restartForm.addEventListener("submit", function(e) {
      document.getElementById("waitModal").style.display = "block";
    });
  }
});
</script>
{% endblock %}
