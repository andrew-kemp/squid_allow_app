<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Overview</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  {% if changes_pending %}
  <div class="banner-alert" id="banner-alert">
    Changes detected: Please restart the Squid service to apply updates.
    <button type="button" class="btn btn-warning" id="restart-squid-btn">Restart Squid</button>
    <span id="restart-spinner" style="display:none;vertical-align:middle;">
      <svg width="28" height="28" viewBox="0 0 44 44" stroke="#2563eb">
        <g fill="none" fill-rule="evenodd" stroke-width="4">
          <circle cx="22" cy="22" r="20" stroke-opacity=".2"/>
          <path d="M42 22c0-11.046-8.954-20-20-20">
            <animateTransform attributeName="transform" type="rotate"
              from="0 22 22" to="360 22 22"
              dur="0.9s" repeatCount="indefinite"/>
          </path>
        </g>
      </svg>
      Restarting...
    </span>
  </div>
  <script>
  document.getElementById("restart-squid-btn").onclick = function() {
    this.style.display = "none";
    document.getElementById("restart-spinner").style.display = "inline-block";
    fetch('{{ url_for("restart_squid") }}', {method:"POST"})
      .then(r => r.json())
      .then(data => {
        document.getElementById("restart-spinner").innerHTML = data.message || "Restarted!";
        setTimeout(() => location.reload(), 2000);
      });
  };
  </script>
  {% endif %}
  <div class="card">
        <h2>Squid Allow Manager Overview</h2>
        {% include '_actions_button.html' %}
        <table>
            <tr>
                <th>Status</th>
                <th>Domains</th>
                <th>Action</th>
            </tr>
            <tr>
                <td>Domains Allowed</td>
                <td class="count">{{ allowed_count }}</td>
                <td>
                    <a href="{{ url_for('manage_allowed') }}" class="btn">Manage</a>
                </td>
            </tr>
            <tr>
                <td>Domains Confirmed to Block</td>
                <td class="count">{{ blocked_count }}</td>
                <td>
                    <a href="{{ url_for('manage_blocked') }}" class="btn">Manage</a>
                </td>
            </tr>
            <tr>
                <td>Domains Unconfirmed</td>
                <td class="count">{{ unconfirmed_count }}</td>
                <td>
                    <a href="{{ url_for('manage_unsorted') }}" class="btn">Manage</a>
                </td>
            </tr>
        </table>
    </div>
    {% if clients %}
    <div class="card" style="margin-top:32px;">
        <h3>Client Overview</h3>
        <table>
         <tr>
                <th>Client IP</th>
                <th>Last Connected</th>
         </tr>
         {% for ip, last_connected in clients.items() %}
         <tr>
             <td>{{ ip }}</td>
             <td>{{ last_connected }}</td>
         </tr>
         {% endfor %}
        </table>
    </div>
    {% endif %}
  {% include '_floating_buttons.html' %}
</body>
</html>